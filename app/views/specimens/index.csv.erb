<%- headers = ['id', 'kingdom', 'phylum', 'class', 'order', 'family', 'genus', 'species', 'taxonrank', 'scientificname',
    	       'decimallatitude', 'decimallongitude', 'coordinateuncertaintyinmeters', 'elevation', 'time', 'day', 'month', 'year',
               'description', 'quantity', 'bodylength', 'sex', 'form', 'notes', 'idconfidence', 'other', 'ref', 'disposition',
               'numphotos'] -%>
<%= CSV.generate_line headers -%>
<%- @specimens.each do | specimen | -%>
  <%- txn = specimen.taxon || NullTaxon.new -%>
  <%- site = specimen.site -%>
  <%- loc = site.location -%>
  <% for i in 1..(specimen.quantity || 1) %>
<%= CSV.generate_line([specimen.id,
        txn.ancestor_with_rank(:Kingdom).scientific_name,
        txn.ancestor_with_rank(:Phylum).scientific_name,
        txn.ancestor_with_rank(:Class).scientific_name,
        txn.ancestor_with_rank(:Order).scientific_name,
        txn.ancestor_with_rank(:Family).scientific_name,
        txn.ancestor_with_rank(:Genus).scientific_name,
        txn.ancestor_with_rank(:Species).scientific_name,
        txn.rank,
        txn.scientific_name,
        loc.latitude,
        loc.longitude,
        loc.error,
        loc.altitude,
        site.started_at.to_s(:time),
        site.started_at.day,
        site.started_at.month,
        site.started_at.year,
        specimen.description,
        specimen.quantity,
        specimen.body_length,
        specimen.sex,
        specimen.form,
        specimen.notes,
        specimen.id_confidence,
        specimen.other,
        specimen.ref,
        specimen.disposition,
        specimen.photos.length
        ]
        ).html_safe -%>
  <%- end -%>
<%- end -%>